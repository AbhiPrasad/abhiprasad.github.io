---
import Layout from "../layouts/Layout.astro";
import blog from "../data/blog.json";
import { enrichBlogPostsWithImages } from "../utils/fetchOgImage";

// Sort blog posts by date (newest first)
const sortedBlog = [...blog].sort((a, b) => b.date.localeCompare(a.date));

// Fetch OG images for all posts at build time
const postsWithImages = await enrichBlogPostsWithImages(sortedBlog);

function formatDate(dateStr: string): string {
  const date = new Date(dateStr);
  return date.toLocaleDateString("en-US", { year: "numeric", month: "long" });
}
---

<Layout
  title="Blog Posts - Abhijeet Prasad"
  description="All blog posts by Abhijeet Prasad"
>
  <header>
    <a href="/" class="back-link">&larr; Back to home</a>
    <h1>Blog Posts</h1>
  </header>

  <section>
    {
      postsWithImages.map((post) => (
        <article class="card blog-card">
          <a href={post.url} target="_blank" rel="noopener noreferrer" class="image-link">
            {post.image ? (
              <img src={post.image} alt={post.title} loading="lazy" />
            ) : (
              <div class="image-placeholder">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20" />
                  <path d="M8 7h6" />
                  <path d="M8 11h8" />
                </svg>
              </div>
            )}
          </a>
          <div class="blog-content">
            <h3>{post.title}</h3>
            <p class="meta">{formatDate(post.date)}</p>
            <p class="description">{post.description}</p>
            <div class="links">
              <a href={post.url} target="_blank" rel="noopener noreferrer">
                Read Post
              </a>
            </div>
          </div>
        </article>
      ))
    }
  </section>
</Layout>

<style>
  header {
    margin-bottom: var(--spacing-lg);
  }

  .back-link {
    display: inline-block;
    margin-bottom: var(--spacing-md);
    color: var(--color-primary);
    font-size: 0.875rem;
  }

  .back-link:hover {
    color: var(--color-accent);
  }

  .blog-card {
    display: flex;
    flex-direction: column;
    overflow: hidden;
    padding: 0;
  }

  .blog-card .image-link {
    display: block;
    width: 100%;
    overflow: hidden;
  }

  .blog-card img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .blog-card:hover img {
    transform: scale(1.02);
  }

  .image-placeholder {
    width: 100%;
    height: 200px;
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-text-light);
    opacity: 0.9;
    transition: opacity 0.3s ease;
  }

  .blog-card:hover .image-placeholder {
    opacity: 1;
  }

  .blog-content {
    padding: var(--spacing-md);
  }

  @media (min-width: 600px) {
    .blog-card {
      flex-direction: row;
    }

    .blog-card .image-link {
      width: 280px;
      flex-shrink: 0;
    }

    .blog-card img {
      width: 280px;
      height: 100%;
      min-height: 180px;
    }

    .image-placeholder {
      width: 280px;
      height: 100%;
      min-height: 180px;
    }

    .blog-content {
      flex: 1;
    }
  }
</style>
