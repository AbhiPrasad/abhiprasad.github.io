---
import Layout from "../layouts/Layout.astro";
import { enrichPresentationsWithThumbnails } from "../utils/fetchOgImage";

// Load all presentation files from the presentations directory
const presentationFiles = import.meta.glob("../data/presentations/*.json", {
  eager: true,
});
const presentations = Object.values(presentationFiles).flatMap(
  (module: any) => module.default
);

// Sort presentations by date (newest first)
const sortedPresentations = enrichPresentationsWithThumbnails(
  [...presentations].sort(
    (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()
  )
);

function formatPresentationDate(dateStr: string): string {
  const date = new Date(dateStr);
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---

<Layout
  title="Presentations & Talks - Abhijeet Prasad"
  description="All presentations and talks by Abhijeet Prasad"
>
  <header>
    <a href="/" class="back-link">&larr; Back to home</a>
    <h1>Presentations & Talks</h1>
  </header>

  <section>
    {
      sortedPresentations.map((talk) => (
        <article class={`card ${talk.thumbnail ? "presentation-card" : ""}`}>
          {talk.thumbnail && talk.video && (
            <a href={talk.video} target="_blank" rel="noopener noreferrer" class="thumbnail-link">
              <img src={talk.thumbnail} alt={talk.title} loading="lazy" />
              <div class="play-overlay">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8 5v14l11-7z"/>
                </svg>
              </div>
            </a>
          )}
          <div class={talk.thumbnail ? "presentation-content" : ""}>
            <h3>{talk.title}</h3>
            <p class="meta">
              {talk.event} Â· {formatPresentationDate(talk.date)}
            </p>
            {talk.description && <p class="description">{talk.description}</p>}
            <div class="links">
              {talk.slides && (
                <a href={talk.slides} target="_blank" rel="noopener noreferrer">
                  Slides
                </a>
              )}
              {talk.slidePdf && (
                <a href={talk.slidePdf} target="_blank" rel="noopener noreferrer">
                  PDF
                </a>
              )}
              {talk.video && (
                <a href={talk.video} target="_blank" rel="noopener noreferrer">
                  Video
                </a>
              )}
            </div>
          </div>
        </article>
      ))
    }
  </section>
</Layout>

<style>
  header {
    margin-bottom: var(--spacing-lg);
  }

  .back-link {
    display: inline-block;
    margin-bottom: var(--spacing-md);
    color: var(--color-primary);
    font-size: 0.875rem;
  }

  .back-link:hover {
    color: var(--color-accent);
  }

  .presentation-card {
    display: flex;
    flex-direction: column;
    overflow: hidden;
    padding: 0;
    border-left: none;
    border-radius: 8px;
  }

  .presentation-card .thumbnail-link {
    display: block;
    width: 100%;
    overflow: hidden;
    position: relative;
  }

  .presentation-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .presentation-card:hover img {
    transform: scale(1.02);
  }

  .play-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.3);
    color: white;
    opacity: 0.8;
    transition: opacity 0.3s ease;
  }

  .presentation-card:hover .play-overlay {
    opacity: 1;
    background: rgba(0, 0, 0, 0.5);
  }

  .presentation-content {
    padding: var(--spacing-md);
  }

  @media (min-width: 600px) {
    .presentation-card {
      flex-direction: row;
    }

    .presentation-card .thumbnail-link {
      width: 240px;
      flex-shrink: 0;
    }

    .presentation-card img {
      width: 240px;
      height: 100%;
      min-height: 135px;
    }

    .presentation-content {
      flex: 1;
    }
  }
</style>
